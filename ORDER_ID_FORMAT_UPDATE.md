# âœ… Order ID Format Updated - YYYY-X

## ğŸ‰ **Update Complete!**

Order IDs are now generated in the format **`YYYY-X`** where:
- **YYYY** = Current year (e.g., 2025)
- **X** = Sequential number starting from 0

---

## ğŸ“ **Changes Made**

### **1. Created Order ID Generator** (`src/utils/orderIdGenerator.ts`)

**New Utility Functions:**
```typescript
// Generate sequential order ID
generateOrderId(existingOrders): string
  â†’ Returns: "2025-0", "2025-1", "2025-2", etc.

// Validate order ID format
isValidOrderIdFormat(orderId): boolean
  â†’ Checks if ID matches YYYY-X pattern

// Parse order ID
parseOrderId(orderId): { year, sequence }
  â†’ Extracts year and sequence from ID
```

**How it Works:**
```typescript
1. Get current year (e.g., 2025)
2. Filter orders from current year
3. Extract existing sequence numbers
4. Find highest sequence number
5. Return next sequential ID
```

---

### **2. Updated OrderContext** (`src/contexts/OrderContext.tsx`)

**Before:**
```typescript
orderId: orderData.orderId || `ORD-${Date.now()}`
// Generated: "ORD-1729876543210"
```

**After:**
```typescript
const generatedOrderId = generateOrderId(orders);
orderId: orderData.orderId || generatedOrderId
// Generated: "2025-0", "2025-1", "2025-2"
```

---

### **3. Updated Gemini PDF Extractor** (`src/services/geminiPdfExtractor.ts`)

**Before:**
```typescript
const safeOrderId = geminiData.poNumber 
  ? geminiData.poNumber.replace(/[\/\\]/g, '-')
  : `ORD-${Date.now()}`;
  
orderId: safeOrderId
// Generated from PO: "001-2025" or "ORD-1729876543210"
```

**After:**
```typescript
// orderId will be auto-generated by createOrder function
// No orderId set here - let OrderContext generate it
// Generated: "2025-0", "2025-1", "2025-2"
```

---

### **4. Updated Python PDF Extractor** (`src/services/pdfExtractorService.ts`)

**Before:**
```typescript
orderId: data.PO_NUMBER || `ORDER_${Date.now()}`
// Generated from PO or timestamp
```

**After:**
```typescript
orderId: '' // Will be generated by createOrder function
// Generated: "2025-0", "2025-1", "2025-2"
```

---

## ğŸ¯ **Order ID Examples**

### **2025 Orders:**
```
First order of 2025:    2025-0
Second order of 2025:   2025-1
Third order of 2025:    2025-2
...
100th order of 2025:    2025-99
1000th order of 2025:   2025-999
```

### **2026 Orders (next year):**
```
First order of 2026:    2026-0
Second order of 2026:   2026-1
Third order of 2026:    2026-2
```

### **Sequential Logic:**
```
Existing orders: [2025-0, 2025-1, 2025-5]
Next ID: 2025-6  (max + 1)

New year starts:
Existing orders: [2025-999, 2026-0]
Next ID: 2026-1  (resets for new year)
```

---

## ğŸ“Š **How It Works**

### **Step-by-Step:**

```
1. User uploads PDF or creates order
   â†“
2. PDF extraction happens (Gemini or Python)
   â†“
3. Order data prepared WITHOUT orderId
   â†“
4. createOrder() called in OrderContext
   â†“
5. generateOrderId(orders) called:
   - Gets current year: 2025
   - Filters orders from 2025
   - Finds highest sequence: 42
   - Returns: "2025-43"
   â†“
6. Order created with ID: "2025-43"
   â†“
7. Saved to MongoDB with ID: "2025-43"
```

---

## ğŸ¨ **Visual Example**

### **Timeline of Orders:**

```
Date: Jan 1, 2025
Order: 2025-0 (Paracetamol API)

Date: Jan 5, 2025
Order: 2025-1 (Ibuprofen USP)

Date: Jan 10, 2025
Order: 2025-2 (Aspirin API)

Date: Feb 15, 2025
Order: 2025-3 (Amoxicillin)

...

Date: Dec 31, 2025
Order: 2025-999 (Last order of year)

Date: Jan 1, 2026
Order: 2026-0 (Sequence resets for new year)
```

---

## âœ… **Benefits**

### **1. Sequential & Organized:**
- âœ… Easy to track order count per year
- âœ… Clean numbering system
- âœ… No duplicates

### **2. Year-Based:**
- âœ… Automatic year prefix
- âœ… Resets each year
- âœ… Easy to identify order year

### **3. Simple Format:**
- âœ… Short and readable
- âœ… No special characters
- âœ… URL-safe (no slashes)

### **4. Unique:**
- âœ… Each order has unique ID
- âœ… Sequential within year
- âœ… Never conflicts

---

## ğŸ” **Where PO Number Goes**

### **PO Number is Still Stored!**

**Before:** PO number was used as order ID
```typescript
orderId: "001/2025"  // PO number used as ID âŒ
```

**After:** PO number stored separately
```typescript
orderId: "2025-0",     // Sequential system ID âœ…
poNumber: "001/2025"   // Original PO number preserved âœ…
```

### **Display:**
```
Order Details:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Order ID: 2025-42          â† System generated
PO Number: 001/2025        â† From customer PDF
Customer: ABC Pharma
Material: Paracetamol API
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## ğŸ“ **File Locations**

### **New Files:**
- âœ… `src/utils/orderIdGenerator.ts` - ID generation logic

### **Modified Files:**
- âœ… `src/contexts/OrderContext.tsx` - Uses new generator
- âœ… `src/services/geminiPdfExtractor.ts` - Removed PO-based ID
- âœ… `src/services/pdfExtractorService.ts` - Removed PO-based ID

---

## ğŸ§ª **Testing**

### **Test 1: First Order of Year**
```
Existing orders: []
Current year: 2025
Generated ID: "2025-0" âœ…
```

### **Test 2: Sequential Orders**
```
Existing orders: ["2025-0", "2025-1"]
Current year: 2025
Generated ID: "2025-2" âœ…
```

### **Test 3: Gap in Sequence**
```
Existing orders: ["2025-0", "2025-5", "2025-10"]
Current year: 2025
Generated ID: "2025-11" âœ… (max + 1)
```

### **Test 4: New Year**
```
Existing orders: ["2025-0", "2025-1", "2025-2"]
Current year: 2026
Generated ID: "2026-0" âœ… (resets for new year)
```

### **Test 5: Mixed Years**
```
Existing orders: ["2024-100", "2025-0", "2025-1"]
Current year: 2025
Generated ID: "2025-2" âœ… (only counts 2025 orders)
```

---

## ğŸ”’ **Data Preservation**

### **Nothing Lost:**

**Customer PO Number:**
```typescript
poNumber: "001/2025"  // Stored in poNumber field âœ…
```

**Order ID:**
```typescript
orderId: "2025-0"     // System-generated âœ…
```

**Both Visible in UI:**
```
Order: 2025-42
PO#: 001/2025
Customer: ABC Pharmaceuticals
```

---

## ğŸ“Š **Database Structure**

### **MongoDB Document:**
```javascript
{
  _id: ObjectId("..."),
  orderId: "2025-42",        // System ID (YYYY-X)
  poNumber: "001/2025",      // Customer PO number
  createdAt: "2025-10-22T...",
  customer: { ... },
  materials: [ ... ]
}
```

---

## ğŸ¯ **Advantages Over Previous System**

| Aspect | Before | After |
|--------|--------|-------|
| **Format** | `001/2025` or `ORD-1729876543210` | `2025-42` |
| **Source** | From PDF (unreliable) | System generated |
| **Uniqueness** | Could have duplicates | Always unique |
| **Sequential** | No | Yes |
| **URL-Safe** | No (had slashes) | Yes |
| **Readable** | Timestamp hard to read | Clear and simple |
| **Year Tracking** | Manual | Automatic |
| **PO Preserved** | No (used as ID) | Yes (in poNumber) |

---

## âœ… **Status**

```
âœ… Order ID generator created
âœ… Format: YYYY-X (e.g., 2025-0)
âœ… Sequential numbering
âœ… Year-based reset
âœ… OrderContext updated
âœ… Gemini extractor updated
âœ… Python extractor updated
âœ… PO number preserved separately
âœ… No linting errors
âœ… Ready to use!
```

---

## ğŸš€ **Ready to Test**

**Restart your frontend:**
```bash
npm start
```

**Then:**
1. Upload a PDF or create an order
2. Check the generated order ID
3. Should see: `2025-0` (or next sequential number)
4. PO number from PDF is stored in `poNumber` field
5. Both displayed separately in UI

---

## ğŸ“ **Examples in Action**

### **Scenario 1: First Order Ever**
```
Upload PDF with PO: "CUST-001/2025"
Generated Order ID: "2025-0"
Stored PO Number: "CUST-001/2025"
Display: "Order: 2025-0 | PO: CUST-001/2025"
```

### **Scenario 2: After 50 Orders**
```
Upload PDF with PO: "ABC-XYZ-2025"
Generated Order ID: "2025-50"
Stored PO Number: "ABC-XYZ-2025"
Display: "Order: 2025-50 | PO: ABC-XYZ-2025"
```

### **Scenario 3: New Year Starts**
```
Date: January 1, 2026
Upload PDF with PO: "FIRST-2026"
Generated Order ID: "2026-0"
Stored PO Number: "FIRST-2026"
Display: "Order: 2026-0 | PO: FIRST-2026"
```

---

**Implementation Date**: October 22, 2025
**Format**: YYYY-X
**Status**: âœ… Complete
**Next Order ID**: Will be generated as `2025-X` where X is the next sequential number

ğŸ‰ **Order ID format updated to YYYY-X!** ğŸ‰

